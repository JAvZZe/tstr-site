#!/bin/bash
# Comprehensive Form Testing Plan for TSTR.site
# Tests all forms after RLS policy fixes

echo "üß™ TSTR.site Form Testing Plan"
echo "=============================="
echo ""

echo "üìã FORMS TO TEST:"
echo "1. Submit Form (/submit) - NEW LISTING SUBMISSION"
echo "2. Signup Form (/signup) - USER REGISTRATION"
echo "3. Login Form (/login) - USER AUTHENTICATION"
echo "4. Lead Capture Forms - EMAIL COLLECTION"
echo "5. Waitlist Form (/waitlist) - EMAIL COLLECTION"
echo ""

echo "üéØ CRITICAL TEST: Submit Form RLS Verification"
echo "----------------------------------------------"
echo "The submit form is most critical since we just fixed its RLS policies."
echo ""
echo "TEST SCENARIOS:"
echo "1. Anonymous submission (should work, create 'pending' status)"
echo "2. Authenticated user submission (should work)"
echo "3. Verify data appears in database with correct permissions"
echo "4. Verify RLS prevents unauthorized access"
echo ""

echo "üõ†Ô∏è  TESTING METHODS:"
echo ""
echo "METHOD 1: Manual Browser Testing"
echo "1. Visit https://tstr.site/submit"
echo "2. Fill form with test data:"
echo "   - Business Name: 'RLS Test Lab'"
echo "   - Email: 'test@rls-test.com'"
echo "   - Website: 'https://rls-test-lab.com'"
echo "   - Category: 'Environmental Testing'"
echo "   - Address: 'Test City, Test Country'"
echo "   - Description: 'Testing RLS policies after fixes'"
echo "3. Submit and verify success message"
echo "4. Check database for new listing with status='pending'"
echo ""

echo "METHOD 2: Browser Console Testing"
echo "1. Open browser dev tools on /submit page"
echo "2. Copy and paste the test code from test_rls_browser.js"
echo "3. Run testRLSPolicies() function"
echo "4. Manually submit form to verify end-to-end"
echo ""

echo "METHOD 3: Database Verification"
echo "After submission, check database:"
echo "SELECT id, business_name, status, verified, claimed, created_at"
echo "FROM listings"
echo "WHERE business_name LIKE '%RLS Test%'"
echo "ORDER BY created_at DESC LIMIT 1;"
echo ""
echo "Expected: status='pending', verified=false, claimed=false"
echo ""

echo "üîê RLS POLICY VERIFICATION:"
echo "After successful submission, test that RLS works:"
echo "1. Try to SELECT from listings as anonymous user (should fail)"
echo "2. Login and verify you can see your own submissions"
echo "3. Verify other users cannot see your submissions"
echo ""

echo "üìä SUCCESS CRITERIA:"
echo "‚úÖ Form submits without errors"
echo "‚úÖ Success message appears"
echo "‚úÖ Data appears in database with correct status"
echo "‚úÖ RLS policies prevent unauthorized access"
echo "‚úÖ No security errors in browser console"
echo ""

echo "üö® IF TESTS FAIL:"
echo "1. Check browser console for RLS errors"
echo "2. Verify migration was applied: supabase db pull"
echo "3. Check Supabase dashboard for policy existence"
echo "4. Review column mappings in column_mappings.txt"
echo ""

echo "Ready to test! Start with the submit form at https://tstr.site/submit"